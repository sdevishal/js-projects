<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CountDown Timer</title>
    <link rel="stylesheet" href="style.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css"
    />
  </head>
  <body>
    <!-- popup modal  -->
    <div id="timeUpPopup" class="popup hidden">
      <div class="popup-content">
        <p><span id="clock-icon">‚è∞</span> Time Up!</p>
        <i class="fa-solid fa-circle-xmark modal-close"></i>
      </div>
    </div>
    <!-- ends here       -->

    <main class="container">
      <audio
        id="ringtone"
        autoplay="true"
        muted=""
        playsinline=""
        src="./assets/ringtone.mp3"
      ></audio>
      <div class="container-title">
        <p id="title">Countdown Timer</p>
      </div>
      <div class="container-labels">
        <p class="container-labels-label">Hours</p>
        <p class="container-labels-label">Minutes</p>
        <p class="container-labels-label">Seconds</p>
      </div>
      <div class="container-inputs">
        <input
          type="number"
          maxlength="2"
          oninput="this.value=this.value.slice(0, this.maxLength)"
          id="hour"
          placeholder="00"
        />
        <p class="input-semicolon">:</p>
        <input
          type="number"
          maxlength="2"
          oninput="this.value=this.value.slice(0, this.maxLength)"
          id="min"
          placeholder="00"
        />
        <p class="input-semicolon">:</p>

        <input
          type="number"
          maxlength="2"
          oninput="this.value=this.value.slice(0, this.maxLength)"
          id="sec"
          placeholder="00"
        />
      </div>
      <div class="container-btns">
        <i class="fa-solid fa-circle-play start"></i>
        <i class="fa-solid fa-circle-pause stop"></i>
        <i class="fa-solid fa-circle-xmark reset"></i>
      </div>
    </main>
    <script>
      const startBtn = document.querySelector(".start");
      const stopBtn = document.querySelector(".stop");
      const resetBtn = document.querySelector(".reset");
      const hour = document.querySelector("#hour");
      const min = document.querySelector("#min");
      const sec = document.querySelector("#sec");
      const ringtone = document.querySelector("#ringtone");
      let countdownTimer;

      // starts here
      const popup = document.querySelector("#timeUpPopup");
      // const popupOk = document.getElementById("popupOk");
      const modalClose = document.querySelector(".modal-close");

      modalClose.addEventListener("click", () => {
        console.log("modalClose clicked");
        popup.classList.add("hidden");
        ringtone.pause();
        ringtone.currentTime = 0;
      });

      function showTimeUpPopup() {
        popup.classList.remove("hidden");
        ringtone.loop = true;
        ringtone.play();
      }

      // ends here

      //Event Listeners
      startBtn.addEventListener("click", startTimer);
      stopBtn.addEventListener("click", stopTimer);
      resetBtn.addEventListener("click", resetTimer);

      //Functions
      function disableInputs(disabled) {
        hour.disabled = disabled;
        min.disabled = disabled;
        sec.disabled = disabled;
      }

      function startTimer() {
        //if input field is empty, NO Action
        if (hour.value == 0 && min.value == 0 && sec.value == 0) return;
        //switch button
        stopBtn.classList.add("active");
        startBtn.classList.add("active");
        resetBtn.classList.add("active");

        //disable editing input field, if timer is running
        if (hour.value !== 0 && min.value !== 0 && sec.value !== 0) {
          disableInputs(true);
        }

        countdownTimer = setInterval(runTimer, 1000);
      }

      function runTimer() {
        if (sec.value > 60) {
          min.value++;
          sec.value = parseInt(sec.value) - 59;
        }

        if (hour.value == 0 && min.value == 0 && sec.value == 0) {
          hour.value = "";
          min.value = "";
          sec.value = "";
          clearInterval(countdownTimer);
          stopBtn.classList.remove("active");
          startBtn.classList.remove("active");
          resetBtn.classList.remove("active");

          // Delay the alert to allow UI updates first
          // setTimeout(() => {
          //   alert("Time Up!");
          // }, 10);
          disableInputs(false); // edit input after Time-Up
          showTimeUpPopup(); //starts here
        } else if (sec.value != 0) {
          sec.value = `${sec.value <= 10 ? "0" : ""}${sec.value - 1}`;
        } else if (min.value != 0 && sec.value == 0) {
          min.value = `${min.value <= 10 ? "0" : ""}${min.value - 1}`;
          sec.value = 59;
        } else if (hour.value != 0 && min.value == 0) {
          hour.value = `${hour.value <= 10 ? "0" : ""}${hour.value - 1}`;
          min.value = 60;
        }
      }

      function stopTimer() {
        stopBtn.classList.remove("active");
        startBtn.classList.remove("active");
        clearInterval(countdownTimer);
        disableInputs(false);
      }

      function resetTimer() {
        hour.value = "";
        min.value = "";
        sec.value = "";
        clearInterval(countdownTimer);
        stopBtn.classList.remove("active");
        startBtn.classList.remove("active");
        resetBtn.classList.remove("active");
      }
    </script>
  </body>
</html>
